---
title: 消息队列
date: 2017-10-18 21:49:19
tags:
---

消息队列是一个队列结构的中间件，通常用于大流量系统分流，将消息或者内容放入队列中，不需要立即处理，直接返回，另有一个程序不停的读这个队列，按顺序处理。

### 消息队列介质
- MySQL： 可靠性高，易实现，速度慢
- Redis： 速度快，单条大消息包效率低
- 消息系统： 专业性强，可靠

### 消息处理触发机制
- 死循环读取： 用一个程序不断读取队列，比较容易实现，故障时无法及时修复
- 定时任务： 每隔几秒或者几分钟处理队列，压力均分，有处理上限
- 守护进程： 类似于PHP-FPM，检测队列是否有内容，有内容则出队处理

### 常见的消息队列介质的应用
- MySQL处理消息队列：将业务数据插入一张表，有一个status记录状态，另一个程序来读这张表，来改变status

- Redis消息队列： 利用redis的list结构，一般是实现秒杀业务，将消息入队，如果list长度等于商品库存则秒杀结束，然后用另一个程序来按顺序读取redis队列

- RabbitMQ： 一个实现了AMQP（advance message queue protocol高级消息队列协议）的消息队列系统,结构如下：

![](http://img.blog.csdn.net/20140220173559828)

clientA/B: 也叫producer（生产者），数据发送方。一个message有两个部分：payload(传输的数据)和label（一个描述payload的标签，通过label来决定将这个message发送给哪个consumer）

client1/2/3: 也叫consumer（消费者），数据的接收方。

exchanges: 生产者发送消息的通道

queue： 消费者接受消息的队列

binding： 消息从exchange处取得route到queue的方式


#### 在PHP中使用rabbitMQ
- RabbitMQ的安装（rabbitMQ-server、 php-amqplib 官方推荐的插件）
- 生产者向消息通道发送消息
- 消费者处理消息
